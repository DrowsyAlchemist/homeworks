using System;
using System.Collections.Generic;
using System.Linq;

namespace Lessons
{
    class Lessons
    {
        public static void Main()
        {
            List<Criminal> criminals = GetCriminals(10000);
            Detective detective = new Detective();
            detective.FindCriminalsExcludingPrisoners(criminals);
            Console.ReadKey(true);
        }

        private static List<Criminal> GetCriminals(int count)
        {
            var criminalCreator = new RandomCriminalCreator();
            var criminals = new List<Criminal>();

            for (int i = 0; i < count; i++)
                criminals.Add(new Criminal(criminalCreator));

            return criminals;
        }
    }

    class Detective
    {
        private const int HeightEpsilon = 5;
        private const int WeidthEpsilon = 5;

        public void FindCriminalsExcludingPrisoners(List<Criminal> criminals)
        {
            int height = GetHeight();
            int weight = GetWeigh();
            string nationality = GetNationality();
            Console.Clear();
            var result = criminals.OrderByDescending(x => x.IsInCustody)
                        .SkipWhile(x => x.IsInCustody == true)
                        .Where(x =>
                               x.Height > height - HeightEpsilon
                            && x.Height < height + HeightEpsilon
                            && x.Weight > weight - WeidthEpsilon
                            && x.Weight < weight + WeidthEpsilon
                            && x.Nationality.ToLower().Equals(nationality.ToLower()));

            if (result.Any())
                foreach (var criminal in result)
                    criminal.ShowInfo();
            else
                Console.WriteLine("В базе нет никого с таким описанием.");
        }

        private int GetHeight()
        {
            Console.Write("Введите рост пеступника в сантиметрах: ");
            int.TryParse(Console.ReadLine(), out var height);
            return height;
        }

        private int GetWeigh()
        {
            Console.Write("Введите вес пеступника в килограммах: ");
            int.TryParse(Console.ReadLine(), out var weight);
            return weight;
        }

        private string GetNationality()
        {
            Console.Write("Введите национальность пеступника: ");
            string nationality = Console.ReadLine();
            return nationality;
        }
    }

    class Criminal
    {
        public Criminal(RandomCriminalCreator criminalCreator)
        {
            Name = criminalCreator.Name;
            IsInCustody = criminalCreator.IsInCustody;
            Height = criminalCreator.Height;
            Weight = criminalCreator.Weight;
            Nationality = criminalCreator.Nationality;
        }

        public string Name { get; private set; }
        public bool IsInCustody { get; private set; }
        public int Height { get; private set; }
        public int Weight { get; private set; }
        public string Nationality { get; private set; }

        public void ShowInfo()
        {
            Console.Write(
                $"Имя преступника: {Name}\n" +
                $"Рост: {Height}\n" +
                $"Вес: {Weight}\n" +
                $"Национальность: {Nationality}\n" +
                $"Заключён под стражу: ");
            Console.WriteLine(IsInCustody ? ("Да\n") : "Нет\n");
        }
    }

    class RandomCriminalCreator
    {
        private const int MaxHeihgt = 210;
        private const int MinHeihgt = 140;
        private const int MaxWeight = 120;
        private const int MinWeight = 60;
        private static Random _random = new Random();
        private string[] _names =
        {
            "Боб",
            "Марк",
            "Майкл",
            "Джордж",
            "Кевин",
            "Дэнис",
            "Анджела",
            "Маргарет",
        };
        private string[] _nationalities =
        {
            "Китаец",
            "Араб",
            "Американец",
            "Русский",
            "Японец",
            "Немец",
        };

        public string Name => _names[_random.Next(_names.Length)];
        public bool IsInCustody => Convert.ToBoolean(_random.Next(2));
        public int Height => _random.Next(MinHeihgt, MaxHeihgt);
        public int Weight => _random.Next(MinWeight, MaxWeight);
        public string Nationality => _nationalities[_random.Next(_nationalities.Length)];
    }
}
